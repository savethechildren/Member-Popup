{"version":3,"sources":["stc-popup-init.js"],"names":["stc","util","setCookie","cname","cvalue","exdays","domain","sameSite","secure","d","Date","setTime","getTime","expires","toUTCString","document","cookie","getCookie","name","ca","split","i","length","c","charAt","substring","indexOf","createEvent","eventName","element","window","newEvent","CustomEvent","dispatchEvent","jsonp","src","options","callback_name","callbackName","on_success","onSuccess","on_timeout","onTimeout","timeout","timeout_trigger","setTimeout","data","clearTimeout","script","createElement","type","async","getElementsByTagName","appendChild","getDomain","hostName","parts","reverse","toLowerCase","match","event","params","bubbles","cancelable","detail","undefined","evt","initCustomEvent","prototype","Event","geo","locate","country","json","country_code","location","hostname","setUserLanguage","lng","navigator","languages","language","userLanguage","members","popupIsInit","popupTimer","now","modal","init","baseURL","version","stcp","s","parentNode","insertBefore"],"mappings":"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","file":"../js/stc-popup-init.min.js","sourcesContent":["var stc = stc || {};\r\n(function(util){\r\n\r\n    /**\r\n     * Sets a cookie.\r\n     *\r\n     * @param {String} cname Name of the cookie.\r\n     * @param {String} cvalue Value of the cookie.\r\n     * @param {Int} exdays Number of days the cookie will last.\r\n     * @param {String} [domain] The domain name to set the cookie for.\r\n     */\r\n    util.setCookie = function(cname, cvalue, exdays, domain, sameSite, secure) {\r\n        sameSite = sameSite || 'none'\r\n        secure = secure !== false\r\n        var d = new Date()\r\n        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000))\r\n        var expires = 'expires=' + d.toUTCString()\r\n        document.cookie = cname + '=' + cvalue + ';' + expires + ';path=/' +\r\n                (secure ? ';secure;sameSite=' + sameSite : '') +\r\n                (domain ? ';domain=' + domain : '')\r\n    }\r\n\r\n    /**\r\n     * Gets a cookie.\r\n     *\r\n     * @param {String} cname The name of the cookie to retrieve\r\n     * @return {String} The value of the cookie\r\n     */\r\n    util.getCookie = function(cname) {\r\n        var name = cname + '='\r\n        var ca = document.cookie.split(';')\r\n        for(var i = 0; i < ca.length; i++) {\r\n            var c = ca[i]\r\n            while (c.charAt(0) === ' ') {\r\n                c = c.substring(1)\r\n            }\r\n            if (c.indexOf(name) === 0) {\r\n                return c.substring(name.length, c.length)\r\n            }\r\n        }\r\n        return ''\r\n    }\r\n\r\n    /**\r\n     * Creates a custom event and dispatches it straight away\r\n     *\r\n     * @param {string} eventName the name of the event\r\n     * @param {HTMLElement} [element=window] The DOM element to attach\r\n     * the event to (defaults to window)\r\n     */\r\n    util.createEvent = function(eventName, element) {\r\n        element = element || window\r\n        var newEvent = new CustomEvent(eventName)\r\n        element.dispatchEvent(newEvent)\r\n    }\r\n\r\n    /**\r\n     * Retrieves JSON from a web service URL using JSON with padding.\r\n     * @param {string} src The webservice URL.\r\n     * @param {object} options The optional options.\r\n     */\r\n    util.jsonp = function(src, options) {\r\n        var callback_name = options.callbackName || 'callback',\r\n            on_success = options.onSuccess || function(){},\r\n            on_timeout = options.onTimeout || function(){},\r\n            timeout = options.timeout || 10 // sec\r\n\r\n        var timeout_trigger = window.setTimeout(function(){\r\n            window[callback_name] = function(){}\r\n            on_timeout()\r\n        }, timeout * 1000)\r\n\r\n        window[callback_name] = function(data){\r\n            window.clearTimeout(timeout_trigger)\r\n            on_success(data)\r\n        }\r\n\r\n        var script = document.createElement('script')\r\n        script.type = 'text/javascript'\r\n        script.async = true\r\n        script.src = src\r\n\r\n        document.getElementsByTagName('head')[0].appendChild(script)\r\n    }\r\n\r\n    /**\r\n     * Gets the root domain name for a given hostname.\r\n     * @param {string} hostName The full hostname to get the root of.\r\n     * @return {string} The root domain.\r\n     */\r\n    util.getDomain = function(hostName){\r\n        var domain = hostName\r\n\r\n        if (hostName !== null) {\r\n            var parts = hostName.split('.').reverse()\r\n\r\n            if (parts !== null && parts.length > 1) {\r\n                domain = parts[1] + '.' + parts[0]\r\n\r\n                // add exceptions for or(g).xx\r\n                if (hostName.toLowerCase().match(/\\.org?\\.[a-z][a-z]$/) && parts.length > 2) {\r\n                    domain = parts[2] + '.' + domain\r\n                }\r\n            }\r\n        }\r\n\r\n        return domain\r\n    }\r\n\r\n}(stc.util = stc.util || {}));\r\n\r\n\r\n/* polyfill fix for custom event in Internet Explorer */\r\n(function() {\r\n    if (typeof window.CustomEvent === 'function') {\r\n        return false\r\n    } // If not IE\r\n    function CustomEvent(event, params) {\r\n        params = params || { bubbles: false, cancelable: false, detail: undefined }\r\n        var evt = document.createEvent('CustomEvent')\r\n        evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail)\r\n        return evt\r\n    }\r\n    CustomEvent.prototype = window.Event.prototype\r\n    window.CustomEvent = CustomEvent\r\n})()\r\n\nvar stc = stc || {};\r\n(function(geo){\r\n\r\n    /**\r\n     * Locate the visitor by IP.\r\n     *\r\n     * @desc Uses Skype API to retrieve user's country ISO code and set a country cookie.\r\n     *\r\n     * @return {string} 2-letter country ISO code (if set)\r\n     */\r\n    geo.locate = function() {\r\n        stc.geo.country = ''\r\n        stc.geo.country = stc.util.getCookie('stc_country')\r\n        if(typeof stc.geo.country === 'undefined' || stc.geo.country === ''){\r\n            stc.util.jsonp('https://cfwk.savethechildren.ngo/api/geo/country?callback=setCountry', {\r\n                callbackName: 'setCountry',\r\n                onSuccess: function(json){\r\n                    stc.geo.country = json.country_code\r\n                    stc.util.setCookie('stc_country', stc.geo.country, 14, stc.util.getDomain(window.location.hostname))\r\n                    stc.util.createEvent('countryIsSet')\r\n                },\r\n                onTimeout: function(){\r\n                    // do nothing\r\n                },\r\n                timeout: 5,\r\n            })\r\n        } else {\r\n            (function($) {\r\n                stc.util.createEvent('countryIsSet')\r\n            })()\r\n        }\r\n        return stc.geo.country\r\n    }\r\n\r\n    /**\r\n     * Sets the user language variable and cookie.\r\n     * @param {string} [lng] The two-letter language code.\r\n     *   Defaults to the main browser language or the user-set value if present.\r\n     * @return {String} The language code.\r\n     */\r\n    geo.setUserLanguage = function(lng) {\r\n        if(!lng) {\r\n            lng = stc.util.getCookie('stc_user_language') || (navigator.languages ? navigator.languages[0] : navigator.language || navigator.userLanguage)\r\n        }\r\n        if(lng.length < 2) {\r\n            return false\r\n        }\r\n        stc.util.setCookie('stc_user_language', lng, 14, stc.util.getDomain(window.location.hostname))\r\n        geo.userLanguage = lng\r\n        return lng\r\n    }\r\n\r\n    /**\r\n     * The list of recognized country Members.\r\n     */\r\n    geo.members = ['AU', 'CA', 'CH', 'CO', 'DE',\r\n        'DK', 'DO', 'ES', 'FI', 'FJ', 'GB', 'GT',\r\n        'HK', 'HN', 'ID', 'IN', 'IS', 'IT', 'JP',\r\n        'KR', 'LT', 'MX', 'NL', 'NO', 'NZ', 'PH',\r\n        'RO', 'SE', 'SZ', 'US', 'ZA',\r\n    ];\r\n\r\n    /* Initialise some variables on page load */\r\n    (function() {\r\n        geo.setUserLanguage()\r\n        geo.locate()\r\n    })()\r\n\r\n}(stc.geo = stc.geo || {}))\r\n\nstc.popupIsInit = false\r\nstc.popupTimer = Date.now()\r\n\r\nstc.modal.init = function() {\r\n    stc.modal = stc.modal || {}\r\n    stc.modal.baseURL = 'https://www.savethechildren.ngo/covid-popup/dist'\r\n    if(stc.modal.version === 'a' && !stc.popupIsInit && stc.util.getCookie('stc_corona_closed') !== '1') {\r\n        var stcp = document.createElement('script')\r\n        stcp.src = stc.modal.baseURL + '/js/stc-popup.min.js?ver=1572968762390'\r\n        var s = document.getElementsByTagName('script')[0]\r\n        s.parentNode.insertBefore(stcp, s)\r\n        stc.popupIsInit = true\r\n    } else if (stc.modal.version === 'b' && !stc.popupIsInit) {\r\n        if(Date.now() < stc.popupTimer + 180000) {\r\n            window.setTimeout(stc.modal.init, 1000)\r\n            return\r\n        }\r\n        stcp = document.createElement('script')\r\n        stcp.src = stc.modal.baseURL + '/js/stc-popup.min.js?ver=1572968762390'\r\n        s = document.getElementsByTagName('script')[0]\r\n        s.parentNode.insertBefore(stcp, s)\r\n        stc.popupIsInit = true\r\n    }\r\n}\r\n\r\n\r\nstc.modal.init()\r\n"]}