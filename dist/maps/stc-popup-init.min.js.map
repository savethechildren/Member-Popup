{"version":3,"sources":["stc-popup-init.js"],"names":["stc","init","popupIsInit","util","getCookie","geo","members","indexOf","country","popupOrigin","modal","baseURL","stcp","document","createElement","src","s","getElementsByTagName","parentNode","insertBefore","setCookie","cname","cvalue","exdays","domain","sameSite","d","Date","setTime","getTime","expires","toUTCString","cookie","name","ca","split","i","length","c","charAt","substring","createEvent","eventName","element","window","newEvent","CustomEvent","dispatchEvent","jsonp","options","callback_name","callbackName","on_success","onSuccess","on_timeout","onTimeout","timeout","timeout_trigger","setTimeout","data","clearTimeout","script","type","async","appendChild","getDomain","hostName","parts","reverse","toLowerCase","match","event","params","bubbles","cancelable","detail","undefined","evt","initCustomEvent","prototype","Event","locate","json","country_code","location","hostname","setUserLanguage","lng","navigator","languages","language","userLanguage","addEventListener"],"mappings":"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","file":"../js/stc-popup-init.min.js","sourcesContent":["var stc = stc || {};\r\n(function(util){\r\n\r\n    /**\r\n     * Sets a cookie.\r\n     *\r\n     * @param {String} cname Name of the cookie.\r\n     * @param {String} cvalue Value of the cookie.\r\n     * @param {Int} exdays Number of days the cookie will last.\r\n     * @param {String} [domain] The domain name to set the cookie for.\r\n     */\r\n    util.setCookie = function(cname, cvalue, exdays, domain, sameSite) {\r\n        sameSite = sameSite || 'none';\r\n        var d = new Date();\r\n        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));\r\n        var expires = 'expires=' + d.toUTCString();\r\n        document.cookie = cname + '=' + cvalue + ';' + expires + ';path=/' +\r\n                ';secure;sameSite=' + sameSite +\r\n                (domain ? ';domain=' + domain : '');\r\n    };\r\n\r\n    /**\r\n     * Gets a cookie.\r\n     *\r\n     * @param {String} cname The name of the cookie to retrieve\r\n     * @return {String} The value of the cookie\r\n     */\r\n    util.getCookie = function(cname) {\r\n        var name = cname + '=';\r\n        var ca = document.cookie.split(';');\r\n        for(var i = 0; i < ca.length; i++) {\r\n            var c = ca[i];\r\n            while (c.charAt(0) === ' ') {\r\n                c = c.substring(1);\r\n            }\r\n            if (c.indexOf(name) === 0) {\r\n                return c.substring(name.length, c.length);\r\n            }\r\n        }\r\n        return '';\r\n    };\r\n\r\n    /**\r\n     * Creates a custom event and dispatches it straight away\r\n     *\r\n     * @param {string} eventName the name of the event\r\n     * @param {HTMLElement} [element=window] The DOM element to attach\r\n     * the event to (defaults to window)\r\n     */\r\n    util.createEvent = function(eventName, element) {\r\n        element = element || window;\r\n        var newEvent = new CustomEvent(eventName);\r\n        element.dispatchEvent(newEvent);\r\n    };\r\n\r\n    /**\r\n     * Retrieves JSON from a web service URL using JSON with padding.\r\n     * @param {string} src The webservice URL.\r\n     * @param {object} options The optional options.\r\n     */\r\n    util.jsonp = function(src, options) {\r\n        var callback_name = options.callbackName || 'callback',\r\n            on_success = options.onSuccess || function(){},\r\n            on_timeout = options.onTimeout || function(){},\r\n            timeout = options.timeout || 10; // sec\r\n\r\n        var timeout_trigger = window.setTimeout(function(){\r\n            window[callback_name] = function(){};\r\n            on_timeout();\r\n        }, timeout * 1000);\r\n\r\n        window[callback_name] = function(data){\r\n            window.clearTimeout(timeout_trigger);\r\n            on_success(data);\r\n        };\r\n\r\n        var script = document.createElement('script');\r\n        script.type = 'text/javascript';\r\n        script.async = true;\r\n        script.src = src;\r\n\r\n        document.getElementsByTagName('head')[0].appendChild(script);\r\n    };\r\n\r\n    /**\r\n     * Gets the root domain name for a given hostname.\r\n     * @param {string} hostName The full hostname to get the root of.\r\n     * @return {string} The root domain.\r\n     */\r\n    util.getDomain = function(hostName){\r\n        var domain = hostName;\r\n\r\n        if (hostName !== null) {\r\n            var parts = hostName.split('.').reverse();\r\n\r\n            if (parts !== null && parts.length > 1) {\r\n                domain = parts[1] + '.' + parts[0];\r\n\r\n                // add exceptions for or(g).xx\r\n                if (hostName.toLowerCase().match(/\\.org?\\.[a-z][a-z]$/) && parts.length > 2) {\r\n                    domain = parts[2] + '.' + domain;\r\n                }\r\n            }\r\n        }\r\n\r\n        return domain;\r\n    };\r\n\r\n}(stc.util = stc.util || {}));\r\n\r\n\r\n/* polyfill fix for custom event in Internet Explorer */\r\n(function() {\r\n    if (typeof window.CustomEvent === 'function') {\r\n        return false;\r\n    } // If not IE\r\n    function CustomEvent(event, params) {\r\n        params = params || { bubbles: false, cancelable: false, detail: undefined };\r\n        var evt = document.createEvent('CustomEvent');\r\n        evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\r\n        return evt;\r\n    }\r\n    CustomEvent.prototype = window.Event.prototype;\r\n    window.CustomEvent = CustomEvent;\r\n})();\r\n\nvar stc = stc || {};\r\n(function(geo){\r\n\r\n    /**\r\n     * Locate the visitor by IP.\r\n     *\r\n     * @desc Uses Skype API to retrieve user's country ISO code and set a country cookie.\r\n     *\r\n     * @return {string} 2-letter country ISO code (if set)\r\n     */\r\n    geo.locate = function() {\r\n        stc.geo.country = '';\r\n        stc.geo.country = stc.util.getCookie('stc_country');\r\n        if(typeof stc.geo.country === 'undefined' || stc.geo.country === ''){\r\n            stc.util.jsonp('https://cfwk.savethechildren.ngo/api/geo/country?callback=setCountry', {\r\n                callbackName: 'setCountry',\r\n                onSuccess: function(json){\r\n                    stc.geo.country = json.country_code;\r\n                    stc.util.setCookie('stc_country', stc.geo.country, 14, stc.util.getDomain(window.location.hostname));\r\n                    stc.util.createEvent('countryIsSet');\r\n                },\r\n                onTimeout: function(){\r\n                    // do nothing\r\n                },\r\n                timeout: 5,\r\n            });\r\n        } else {\r\n            (function($) {\r\n                stc.util.createEvent('countryIsSet');\r\n            })();\r\n        }\r\n        return stc.geo.country;\r\n    };\r\n\r\n    /**\r\n     * Sets the user language variable and cookie.\r\n     * @param {string} [lng] The two-letter language code.\r\n     *   Defaults to the main browser language or the user-set value if present.\r\n     * @return {String} The language code.\r\n     */\r\n    geo.setUserLanguage = function(lng) {\r\n        if(!lng) {\r\n            lng = stc.util.getCookie('stc_user_language') || (navigator.languages ? navigator.languages[0] : navigator.language || navigator.userLanguage);\r\n        }\r\n        if(lng.length < 2) {\r\n            return false;\r\n        }\r\n        stc.util.setCookie('stc_user_language', lng, 14, stc.util.getDomain(window.location.hostname));\r\n        geo.userLanguage = lng;\r\n        return lng;\r\n    };\r\n\r\n    /**\r\n     * The list of recognized country Members.\r\n     */\r\n    geo.members = ['AU', 'CA', 'CH', 'CO', 'DE',\r\n        'DK', 'DO', 'ES', 'FI', 'FJ', 'GB', 'GT',\r\n        'HK', 'HN', 'ID', 'IN', 'IS', 'IT', 'JP',\r\n        'KR', 'LT', 'MX', 'NL', 'NO', 'NZ', 'PH',\r\n        'RO', 'SE', 'SZ', 'US', 'ZA',\r\n    ];\r\n\r\n    /* Initialise some variables on page load */\r\n    (function() {\r\n        geo.setUserLanguage();\r\n        geo.locate();\r\n    })();\r\n\r\n}(stc.geo = stc.geo || {}));\r\n\nif(stc.geo.country) {\r\n    init();\r\n} else {\r\n    window.addEventListener('countryIsSet', init);\r\n}\r\nstc.popupIsInit = false;\r\n\r\nfunction init() {\r\n    if(!stc.popupIsInit && stc.util.getCookie('stc_popup_closed') !== '1' && stc.geo.members.indexOf(stc.geo.country) > -1 && stc.geo.country !== stc.popupOrigin) {\r\n        stc.modal = stc.modal || {};\r\n        stc.modal.baseURL = 'https://misc/member-popup/dist';\r\n        var stcp = document.createElement('script');\r\n        stcp.src = stc.modal.baseURL + '/js/stc-popup.min.js';\r\n        var s = document.getElementsByTagName('script')[0];\r\n        s.parentNode.insertBefore(stcp, s);\r\n        stc.popupIsInit = true;\r\n    }\r\n}\r\n"]}